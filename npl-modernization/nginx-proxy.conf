upstream thingsboard {
    server mytb:9090;
}

server {
    listen 8081;
    server_name localhost;

    # Proxy all requests to ThingsBoard
    location / {
        proxy_pass http://thingsboard;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Inject our overlay scripts
        sub_filter '</head>' '  <!-- NPL Modernization Overlays -->\n  <script src="assets/overlay/npl-overlay.js" defer></script>\n  <script src="assets/overlay/device-overlay.js" defer></script>\n  <script src="assets/overlay/tenant-overlay.js" defer></script>\n</head>';
        sub_filter_once on;
    }

    # Serve our overlay bundle
    location /assets/overlay/ {
        alias /usr/share/nginx/html/assets/overlay/;
    }
} 